<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body {
          background: linear-gradient(135deg, #eef2ff, #e0f2fe);
          min-height: 100vh;
          display: flex;
        }

        /* Sidebar */
        .sidebar {
          height: 100vh;
          width: 240px;
          background-color: #1f2937;
          position: fixed;
          top: 0;
          left: 0;
          padding-top: 60px;
        }
        .sidebar a {
          color: #9ca3af;
          padding: 15px 20px;
          display: flex;
          align-items: center;
          gap: 10px;
          text-decoration: none;
          transition: 0.3s;
        }
        .sidebar a:hover {
          background-color: #374151;
          color: #fff;
        }

        /* Content */
        .content {
          margin-left: 240px;
          padding: 20px;
          width: 100%;
        }

        /* Header */
        .navbar {
          background: linear-gradient(90deg, #2563eb, #4f46e5);
          box-shadow: 0 4px 15px rgba(0,0,0,0.2);
          border-radius: 10px;
        }

        /* Cards with Double Gradient */
        .dashboard-card {
          min-height: 200px;
          border-radius: 18px;
          color: black;
          text-align: center;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          text-decoration: none;
          position: relative;
          overflow: hidden;
          padding: 18px;
          transition: transform 0.3s ease, box-shadow 0.3s ease;
          background: rgba(255,255,255,0.65);
          border: 1px solid rgba(255,255,255,0.35);
          backdrop-filter: blur(6px);
        }

        /* Gradient Border Effect */
        .dashboard-card::before {
          content: "";
          position: absolute;
          inset: -3px;
          border-radius: 20px;
          background: linear-gradient(135deg, #60a5fa, #a78bfa, #f472b6);
          z-index: -1;
          filter: blur(8px);
          opacity: 0.55;
          transition: opacity 0.3s ease, filter 0.3s ease;
        }

        /* Glossy shine overlay */
        .dashboard-card::after {
          content: "";
          position: absolute;
          top: -40%;
          left: -20%;
          width: 140%;
          height: 60%;
          background: radial-gradient(ellipse at top, rgba(255,255,255,.65), rgba(255,255,255,0) 60%);
          transform: rotate(-8deg);
          pointer-events: none;
        }

        .dashboard-card:hover {
          transform: translateY(-6px) scale(1.03);
          box-shadow: 0 0 18px rgba(0,0,0,0.25);
        }
        .dashboard-card:hover::before {
          opacity: 1;
          filter: blur(2px);
        }

        /* Logout button */
        .btn-gradient {
            background: linear-gradient(90deg, #ef4444, #dc2626);
            color: white;
            border: none;
            transition: 0.3s;
        }
        .btn-gradient:hover {
            background: linear-gradient(90deg, #ec4899, #db2777);
            color: white;
        }

        /* Smooth Inner Gradients */
        .gradient-blue {
          background: linear-gradient(135deg, #3b82f6, #60a5fa);
        }
        .gradient-soft-pink {
          background: linear-gradient(135deg, #ec4899, #f472b6);
        }
        .gradient-soft-indigo {
          background: linear-gradient(135deg, #6366f1, #a78bfa);
        }

        /* Icons */
        .dashboard-icon {
          font-size: 2.6rem;
          margin-bottom: 8px;
        }

        /* Icon badge containers */
        .icon-badge {
          width: 64px;
          height: 64px;
          border-radius: 16px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: #fff;
          margin-bottom: 10px;
          box-shadow: 0 10px 24px rgba(0,0,0,.18);
        }
        .badge-blue { background: linear-gradient(135deg, #2563eb, #60a5fa); }
        .badge-pink { background: linear-gradient(135deg, #ec4899, #f472b6); }
        .badge-indigo { background: linear-gradient(135deg, #4f46e5, #a78bfa); }

        /* Sidebar logout button styled as link */
        .sidebar form.sidebar-logout { margin: 0; }
        .sidebar .logout-btn {
          background: transparent;
          border: none;
          width: 100%;
          text-align: left;
          color: #9ca3af;
          padding: 15px 20px;
          display: flex;
          align-items: center;
          gap: 10px;
          cursor: pointer;
          transition: .3s;
        }
        .sidebar .logout-btn:hover { background-color: #374151; color: #fff; }
    </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <a href="/admin/dashboard">
        <i class="bi bi-house-fill fs-5"></i>
        <span>Dashboard</span>
    </a>
    <a href="/admin/students"><i class="bi bi-people-fill"></i> Student List</a>
    <a href="/admin/keycloak-users"><i class="bi bi-people-fill"></i> KeycloakUser List</a>
    <a href="/students/new"><i class="bi bi-person-plus-fill"></i> Add Student</a>

    <!-- Permission A can see Create User -->
    <a href="/admin/keycloak-users/new" sec:authorize="hasAuthority('PERM_A')">
        <i class="bi bi-shield-lock-fill"></i> Create User
    </a>

    <!-- Permission E can view permissions management -->
    <a href="/admin/permissions" sec:authorize="hasAuthority('PERM_E')">
        <i class="bi bi-shield-check"></i> Permissions
    </a>

    <!-- Permission F can create new permission -->
    <a href="/admin/permissions/new" sec:authorize="hasAuthority('PERM_F')">
        <i class="bi bi-plus-circle"></i> Create Permission
    </a>

    <form th:action="@{/logout}" method="post" class="sidebar-logout">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit" class="logout-btn">
            <i class="bi bi-box-arrow-right"></i>
            <span>Logout</span>
        </button>
    </form>
</div>

<!-- Page Content -->
<div class="content">
    <!-- Header -->
   <!-- <h1 class="mb-4">
        <span sec:authorize="hasAuthority('ROLE_admin')">Welcome Admin</span>
        <span sec:authorize="hasAuthority('ROLE_manager')">Welcome Manager</span>
        <span sec:authorize="hasAuthority('ROLE_jrmanager')">Welcome JrManager</span>
        - <span sec:authentication="name"></span>
    </h1>
-->
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                âœ¨
                <span>Dashboard</span>
                <!--<span sec:authorize="hasRole('clerk')">Clerk Dashboard</span>
                <span sec:authorize="hasRole('user')">User Dashboard</span> -->
                &nbsp;|&nbsp;
                <span sec:authentication="name"></span>
            </a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto align-items-center gap-2">
                    <!-- Profile modal trigger -->
                    <li class="nav-item">
                        <button type="button" class="btn d-flex align-items-center justify-content-center"
                                data-bs-toggle="modal" data-bs-target="#profileModal"
                                style="width:42px;height:42px;border-radius:50%;
                                       background: linear-gradient(135deg,#7c3aed,#2563eb);
                                       color:#fff; box-shadow:0 6px 14px rgba(0,0,0,.25)">
                            <i class="bi bi-person-fill fs-5"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>



    <!-- Cards Section -->
    <div class="container">
        <div class="row g-4 justify-content-center">

            <!-- Card: Add Student (Permission A) -->
            <div class="col-md-4" sec:authorize="hasAuthority('PERM_A')">
                <a href="/students/new" class="card dashboard-card gradient-blue">
                    <div class="icon-badge badge-blue">
                        <i class="bi bi-person-plus-fill dashboard-icon text-white"></i>
                    </div>
                    <h5 class="fw-bold">Add Student</h5>
                    <p>Register a new student</p>
                </a>
            </div>

            <!-- Card: Create Keycloak User (Permission A) -->
            <div class="col-md-4" sec:authorize="hasAuthority('PERM_A')">
                <a href="/admin/keycloak-users/new" class="card dashboard-card gradient-soft-pink">
                    <div class="icon-badge badge-pink">
                        <i class="bi bi-shield-lock-fill dashboard-icon text-white"></i>
                    </div>
                    <h5 class="fw-bold">Create User</h5>
                    <p>Add a Keycloak user</p>
                </a>
            </div>

            <!-- Card: Student Stats -->
            <div class="col-md-4">
                <a href="/admin/students" class="card dashboard-card gradient-soft-indigo">
                    <div class="icon-badge badge-indigo">
                        <i class="bi bi-bar-chart-fill dashboard-icon text-white"></i>
                    </div>
                    <h5 class="fw-bold">Students</h5>
                    <p>Student Details</p>
                </a>
            </div>

            <!-- Card: Keycloak Users -->
            <div class="col-md-4">
                <a href="/admin/keycloak-users" class="card dashboard-card gradient-blue">
                    <div class="icon-badge badge-blue">
                        <i class="bi bi-shield-lock-fill dashboard-icon text-white"></i>
                    </div>
                    <h5 class="fw-bold">Keycloak Users</h5>
                    <p>Manage users and roles</p>
                </a>
            </div>

            <!-- Card: Permissions (Permission E) -->
            <div class="col-md-4" sec:authorize="hasAuthority('PERM_E')">
                <a href="/admin/permissions" class="card dashboard-card gradient-soft-indigo">
                    <div class="icon-badge badge-indigo">
                        <i class="bi bi-shield-check dashboard-icon text-white"></i>
                    </div>
                    <h5 class="fw-bold">Permissions</h5>
                    <p>View and assign permissions</p>
                </a>
            </div>

            <!-- Card: Create Permission (Permission F) -->
            <div class="col-md-4" sec:authorize="hasAuthority('PERM_F')">
                <a href="/admin/permissions/new" class="card dashboard-card gradient-soft-pink">
                    <div class="icon-badge badge-pink">
                        <i class="bi bi-plus-circle dashboard-icon text-white"></i>
                    </div>
                    <h5 class="fw-bold">Create Permission</h5>
                    <p>Add a new permission (Aâ€“Z)</p>
                </a>
            </div>

        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Prevent back navigation
    (function() {
        window.history.pushState(null, "", window.location.href);
        window.onpopstate = function () {
            window.history.pushState(null, "", window.location.href);
        };
    })();
</script>

<!-- Profile Modal -->
<div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-end modal-sm modal-dialog-scrollable">
    <div class="modal-content border-0" style="border-radius:16px; overflow:hidden;">
      <div class="p-4 text-white" style="background: linear-gradient(135deg,#2563eb,#7c3aed);">
        <div class="d-flex align-items-center gap-3">
          <div class="d-flex align-items-center justify-content-center"
               style="width:56px;height:56px;border-radius:50%;background:rgba(255,255,255,.2);">
            <i class="bi bi-person-fill fs-3"></i>
          </div>
          <div>
            <div class="fw-bold" sec:authentication="name">user</div>
            <div class="small" th:text="${#authentication.principal.attributes['email']} ?: '-'">-</div>
          </div>
        </div>
      </div>
      <div class="p-3">
        <div class="small text-muted">Subject ID</div>
        <div class="mb-2" th:text="${#authentication.principal.attributes['sub']} ?: '-'">-</div>

        <div class="small text-muted">Authorities</div>
        <div class="mb-3">
          <code class="d-inline-block px-2 py-1 me-1 mb-1 bg-light border rounded" th:each="a : ${#authentication.authorities}" th:text="${a}">ROLE_user</code>
        </div>

        <div class="d-grid gap-2">
          <form th:action="@{/logout}" method="post" class="d-grid">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="btn btn-outline-danger"><i class="bi bi-box-arrow-right"></i> Logout</button>
          </form>
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  </div>

</body>
</html>
